# This file describes the GitHub Actions workflow for continuous integration of XS Core.
name: XS Core CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
   build-emu:
    runs-on: self-hosted
    name: Make EMU
    steps:
       - uses: actions/checkout@v2
       
       - name: Build EMU
         run: make ./build/emu -j80

  cputest:
    runs-on: self-hosted
    name: Run cputest
    needs: [build-emu]
    steps:
      - uses: actions/checkout@v2
      - env:
          AM_HOME: /home/ci-runner/xsenv/nexus-am
          NEMU_HOME: /home/ci-runner/xsenv/NEMU
          NOOP_HOME: $(PWD)
      - name: Run cpu test
        run: make -C $(AM_HOME)/tests/cputest/ ARCH=riscv64-noop V=OFF run

